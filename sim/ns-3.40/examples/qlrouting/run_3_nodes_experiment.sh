#!/bin/bash

set -e

SEED_BASE=10

WORKLOAD_FILE="${WORKLOAD_FILE:-examples/qlrouting/resources/3_nodes/workloads/wl1.csv}"
WORKLOAD_NAME="$(basename "$WORKLOAD_FILE")"
WORKLOAD_BASE="${WORKLOAD_NAME%.*}"

CONGESTION_CONTROL="${CONGESTION_CONTROL:-TcpLinuxReno}"

RESULTS_DIR="3_nodes_${CONGESTION_CONTROL}_${WORKLOAD_BASE}"

QLR_ACTIVE=0 CONGESTION_CONTROL=${CONGESTION_CONTROL} WORKLOAD_FILE=${WORKLOAD_FILE} EDGES="0,1;0,2;1,2" HOSTS="1,1,1" SWITCHES=3 DAGS="0:1-0,2-0,2-1;1:0-1,0-2,2-1;2:0-1,0-2,1-2" DESTINATION_ID="1" BURST_FLOWS="20" BURST_RATE="10Mbps" END=5 bash run_experiment.sh
QLR_ACTIVE=1 CONGESTION_CONTROL=${CONGESTION_CONTROL} WORKLOAD_FILE=${WORKLOAD_FILE} EDGES="0,1;0,2;1,2" HOSTS="1,1,1" SWITCHES=3 DAGS="0:1-0,2-0,2-1;1:0-1,0-2,2-1;2:0-1,0-2,1-2" DESTINATION_ID="1" BURST_FLOWS="20" BURST_RATE="10Mbps" END=5 bash run_experiment.sh

python3 plot.py results/${RESULTS_DIR} figures/${RESULTS_DIR}
chmod -R 777 figures
