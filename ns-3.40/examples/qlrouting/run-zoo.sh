#!/bin/bash

set -e

CONGESTION_CONTROL="${CONGESTION_CONTROL:-TcpLinuxReno}"
EXPERIMENT_NAME="zoo"

for WORKLOAD_FILE in \
    "examples/qlrouting/resources/11_nodes/workloads/flows.csv"
do
WORKLOAD_NAME="$(basename "$WORKLOAD_FILE")"
WORKLOAD_BASE="${WORKLOAD_NAME%.*}"
RESULTS_DIR="${EXPERIMENT_NAME}_${CONGESTION_CONTROL}_${WORKLOAD_BASE}"
# QLR_ACTIVE=0 P4_PROGRAM=examples/qlrouting/qlr_build/qlr.json P4_COMMANDS="examples/qlrouting/resources/" EXPERIMENT_NAME=${EXPERIMENT_NAME} CONGESTION_CONTROL=${CONGESTION_CONTROL} WORKLOAD_FILE=${WORKLOAD_FILE} DAGS="0:1-0,2-0,10-1,9-2,7-10,8-9,6-7,5-8,3-6,4-5,4-6;1:0-1,10-1,2-0,7-10,9-10,6-7,8-7,8-9,3-6,4-6,5-8;2:0-2,9-2,1-0,8-9,10-9,5-8,7-8,7-10,4-5,6-7,3-4,3-6;3:4-3,6-3,5-4,7-6,8-5,8-7,10-7,9-8,9-10,1-10,2-9,0-1;4:3-4,5-4,6-4,8-5,7-6,9-8,10-7,2-9,1-10,0-1,0-2;5:4-5,8-5,3-4,6-4,7-8,9-8,10-7,10-9,2-9,1-10,0-2;6:3-6,4-6,7-6,5-4,8-7,10-7,9-8,9-10,1-10,2-9,0-1;7:6-7,8-7,10-7,3-6,4-6,5-8,9-8,9-10,1-10,2-9,0-1;8:5-8,7-8,9-8,4-5,6-7,10-7,10-9,2-9,3-4,3-6,1-10,0-2;9:2-9,8-9,10-9,0-2,5-8,7-8,7-10,1-10,4-5,6-7,3-4,3-6;10:1-10,7-10,9-10,0-1,6-7,8-7,8-9,2-9,3-6,4-6,5-8" EDGES="0,1;0,2;1,10;2,9;3,4;3,6;4,5;4,6;5,8;6,7;7,8;7,10;8,9;9,10" HOSTS="1,1,1,1,1,1,1,1,1,1,1" SWITCHES=11 END=10 bash run_experiment.sh
QLR_ACTIVE=1 P4_PROGRAM=examples/qlrouting/qlr_build/qlr.json P4_COMMANDS="examples/qlrouting/resources/" EXPERIMENT_NAME=${EXPERIMENT_NAME} CONGESTION_CONTROL=${CONGESTION_CONTROL} WORKLOAD_FILE=${WORKLOAD_FILE} DAGS="0:1-0,2-0,10-1,9-2,7-10,8-9,6-7,5-8,3-6,4-5,4-6;1:0-1,10-1,2-0,7-10,9-10,6-7,8-7,8-9,3-6,4-6,5-8;2:0-2,9-2,1-0,8-9,10-9,5-8,7-8,7-10,4-5,6-7,3-4,3-6;3:4-3,6-3,5-4,7-6,8-5,8-7,10-7,9-8,9-10,1-10,2-9,0-1;4:3-4,5-4,6-4,8-5,7-6,9-8,10-7,2-9,1-10,0-1,0-2;5:4-5,8-5,3-4,6-4,7-8,9-8,10-7,10-9,2-9,1-10,0-2;6:3-6,4-6,7-6,5-4,8-7,10-7,9-8,9-10,1-10,2-9,0-1;7:6-7,8-7,10-7,3-6,4-6,5-8,9-8,9-10,1-10,2-9,0-1;8:5-8,7-8,9-8,4-5,6-7,10-7,10-9,2-9,3-4,3-6,1-10,0-2;9:2-9,8-9,10-9,0-2,5-8,7-8,7-10,1-10,4-5,6-7,3-4,3-6;10:1-10,7-10,9-10,0-1,6-7,8-7,8-9,2-9,3-6,4-6,5-8" EDGES="0,1;0,2;1,10;2,9;3,4;3,6;4,5;4,6;5,8;6,7;7,8;7,10;8,9;9,10" HOSTS="1,1,1,0,0,0,0,0,0,1,1" SWITCHES=11 END=10 DUMP_TRAFFIC=1 bash run_experiment.sh
# MODE=central P4_PROGRAM=examples/qlrouting/fwd_build/fwd.json EXPERIMENT_NAME=${EXPERIMENT_NAME} CONGESTION_CONTROL=${CONGESTION_CONTROL} WORKLOAD_FILE=${WORKLOAD_FILE} DAGS="0:1-0,2-0,10-1,9-2,7-10,8-9,6-7,5-8,3-6,4-5,4-6;1:0-1,10-1,2-0,7-10,9-10,6-7,8-7,8-9,3-6,4-6,5-8;2:0-2,9-2,1-0,8-9,10-9,5-8,7-8,7-10,4-5,6-7,3-4,3-6;3:4-3,6-3,5-4,7-6,8-5,8-7,10-7,9-8,9-10,1-10,2-9,0-1;4:3-4,5-4,6-4,8-5,7-6,9-8,10-7,2-9,1-10,0-1,0-2;5:4-5,8-5,3-4,6-4,7-8,9-8,10-7,10-9,2-9,1-10,0-2;6:3-6,4-6,7-6,5-4,8-7,10-7,9-8,9-10,1-10,2-9,0-1;7:6-7,8-7,10-7,3-6,4-6,5-8,9-8,9-10,1-10,2-9,0-1;8:5-8,7-8,9-8,4-5,6-7,10-7,10-9,2-9,3-4,3-6,1-10,0-2;9:2-9,8-9,10-9,0-2,5-8,7-8,7-10,1-10,4-5,6-7,3-4,3-6;10:1-10,7-10,9-10,0-1,6-7,8-7,8-9,2-9,3-6,4-6,5-8" EDGES="0,1;0,2;1,10;2,9;3,4;3,6;4,5;4,6;5,8;6,7;7,8;7,10;8,9;9,10" HOSTS="1,1,1,1,1,1,1,1,1,1,1" SWITCHES=11 END=10 bash run_experiment.sh
python3 plot.py results/${RESULTS_DIR} figures/${RESULTS_DIR}
done

chmod -R 777 figures

